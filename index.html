<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Michigan Liquor Price Search</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 1em;
    max-width: 800px;
    margin: auto;
  }
  input[type="text"] {
    width: 100%;
    font-size: 1.2em;
    padding: 0.5em;
  }
  button {
    font-size: 1em;
    margin-top: 0.5em;
    padding: 0.5em 1em;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1em;
  }
  th, td {
    text-align: left;
    border-bottom: 1px solid #ccc;
    padding: 0.3em;
  }
  tr:hover {
    background: #f0f0f0;
  }
</style>
</head>
<body>

<h1>Michigan Liquor Price Search</h1>

<input id="searchInput" type="text" placeholder="Search by Item Code, UPC #1, UPC #2, or Item Name..." />
<button id="searchBtn">Search</button>
<p id="status">Loading data, please wait...</p>

<table id="resultsTable" hidden>
  <thead>
    <tr>
      <th>Item Code</th>
      <th>Brand Name</th>
      <th>ADA Name</th>
      <th>Vendor</th>
      <th>Liquor Type</th>
      <th>Proof</th>
      <th>Bottle Size</th>
      <th>Pack Size</th>
      <th>On Prem Price</th>
      <th>Off Prem Price</th>
      <th>Shelf Price</th>
      <th>UPC #1</th>
      <th>UPC #2</th>
      <th>Effective Date</th>
    </tr>
  </thead>
  <tbody id="resultsBody"></tbody>
</table>

<script>
  const DATA_URL = 'webprbk.txt'; // local file you host on GitHub Pages

  let products = [];

  // Utility to parse one line from fixed-width fields
  function parseLine(line) {
    return {
      liquorCode: line.substring(0, 5).trim(),
      brandName: line.substring(5, 37).trim(),
      adaNumber: line.substring(37, 40).trim(),
      adaName: line.substring(40, 65).trim(),
      vendorName: line.substring(65, 90).trim(),
      liquorType: line.substring(90, 110).trim(),
      proof: line.substring(110, 115).trim(),
      bottleSize: line.substring(115, 122).trim(),
      packSize: line.substring(122, 125).trim(),
      onPremPrice: line.substring(125, 136).trim(),
      offPremPrice: line.substring(136, 147).trim(),
      shelfPrice: line.substring(147, 158).trim(),
      upc1: line.substring(158, 172).trim(),
      upc2: line.substring(172, 186).trim(),
      effectiveDate: line.substring(186, 194).trim(),
    };
  }

  // Format prices with decimals: stored as 9(08).99 but string might be like '0000123456'?
  function formatPrice(priceStr) {
    if (!priceStr || priceStr.length < 3) return '';
    let len = priceStr.length;
    let dollars = priceStr.slice(0, len - 2).replace(/^0+/, '') || '0';
    let cents = priceStr.slice(len - 2);
    return `$${dollars}.${cents}`;
  }

  // Format proof to show decimal (e.g. '0950' = 95.0)
  function formatProof(proofStr) {
    if (!proofStr) return '';
    if (proofStr.length === 5) {
      // e.g. '099.9'
      return proofStr;
    }
    // fallback: insert decimal before last digit
    let n = parseInt(proofStr, 10);
    if (isNaN(n)) return proofStr;
    return (n / 10).toFixed(1);
  }

  function formatDate(mmddccyy) {
    if (mmddccyy.length !== 8) return mmddccyy;
    let mm = mmddccyy.slice(0, 2);
    let dd = mmddccyy.slice(2, 4);
    let yyyy = '20' + mmddccyy.slice(4, 6);
    return `${mm}/${dd}/${yyyy}`;
  }

  async function loadData() {
    document.getElementById('status').textContent = 'Loading data...';
    try {
      const res = await fetch(DATA_URL);
      if (!res.ok) throw new Error('Failed to load data file.');
      const text = await res.text();
      const lines = text.split('\n').filter(l => l.trim().length >= 194);
      products = lines.map(parseLine);
      document.getElementById('status').textContent = `Loaded ${products.length} products.`;
    } catch (e) {
      document.getElementById('status').textContent = 'Error loading data: ' + e.message;
    }
  }

  function searchProducts(query) {
    query = query.trim().toLowerCase();
    if (!query) return [];
    return products.filter(p =>
      p.liquorCode.toLowerCase().includes(query) ||
      p.upc1.toLowerCase().includes(query) ||
      p.upc2.toLowerCase().includes(query) ||
      p.brandName.toLowerCase().includes(query) ||
      p.adaName.toLowerCase().includes(query)
    );
  }

  function displayResults(results) {
    const tbody = document.getElementById('resultsBody');
    tbody.innerHTML = '';
    if (results.length === 0) {
      tbody.innerHTML = '<tr><td colspan="14">No results found.</td></tr>';
    } else {
      for (const p of results) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.liquorCode}</td>
          <td>${p.brandName}</td>
          <td>${p.adaName}</td>
          <td>${p.vendorName}</td>
          <td>${p.liquorType}</td>
          <td>${formatProof(p.proof)}</td>
          <td>${p.bottleSize}</td>
          <td>${p.packSize}</td>
          <td>${formatPrice(p.onPremPrice)}</td>
          <td>${formatPrice(p.offPremPrice)}</td>
          <td>${formatPrice(p.shelfPrice)}</td>
          <td>${p.upc1}</td>
          <td>${p.upc2}</td>
          <td>${formatDate(p.effectiveDate)}</td>
        `;
        tbody.appendChild(tr);
      }
    }
    document.getElementById('resultsTable').hidden = false;
  }

  // Event listeners
  document.getElementById('searchBtn').addEventListener('click', () => {
    const query = document.getElementById('searchInput').value;
    const results = searchProducts(query);
    displayResults(results);
  });

  document.getElementById('searchInput').addEventListener('keypress', e => {
    if (e.key === 'Enter') {
      document.getElementById('searchBtn').click();
    }
  });

  loadData();
</script>

</body>
</html>
